<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå - MMD BORROW</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script type="text/javascript">
       (function(){
          // ‚ö†Ô∏è‚ö†Ô∏è 2. ‡πÄ‡∏≠‡∏≤ Public Key ‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö! ‚ö†Ô∏è‚ö†Ô∏è
          // (‡∏î‡∏π‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π Account ‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö EmailJS ‡∏£‡∏´‡∏±‡∏™‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ user_ ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏°‡∏±‡πà‡∏ß‡πÜ)
          emailjs.init("Rj2WpB-v7fZqvEu08"); 
       })();
    </script>
</head>
<body>
    <div class="bg-animate"></div>
    
    <nav>
        <div class="logo"><i class="fas fa-video"></i> MMD BORROW</div>
        <div class="user-info">
            <span id="userNameDisplay">Loading...</span> 
            <button onclick="openHistoryModal()" class="btn-history"><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
            <button onclick="logout()" class="btn-logout" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"><i class="fas fa-sign-out-alt"></i></button>
        </div>
    </nav>

    <div class="container">
        <div class="filters">
            <button onclick="filterItems('all')" class="active">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button onclick="filterItems('camera')">‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
            <button onclick="filterItems('tripod')">‡∏Ç‡∏≤‡∏ï‡∏±‡πâ‡∏á/Gimbal</button>
            <button onclick="filterItems('audio')">‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
            <button onclick="filterItems('light')">‡πÑ‡∏ü‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠</button>
            <div class="search-box">
                <i class="fas fa-search" style="color: #666;"></i>
                <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå..." onkeyup="searchItem(this.value)">
            </div>
        </div>
        
        <div id="itemGrid" class="item-grid"></div>
    </div>

    <div id="borrowModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 style="color:var(--theme-primary); margin-top:0;"><i class="far fa-edit"></i> ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°: <strong id="modalItemName" style="color: #fff;">...</strong></p>
            
            <form id="borrowForm">
                <label style="color:#888; font-size:12px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</label>
                <input type="text" id="borrowerName" readonly style="color:#666; cursor:not-allowed;">
                
                <label style="color:#888; font-size:12px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô</label>
                <input type="date" required>

                <label style="color:#888; font-size:12px; margin-top:10px; display:block;">‡∏£‡∏π‡∏õ‡∏™‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á / ‡∏ö‡∏±‡∏ï‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                <input type="file" id="borrowProof" accept="image/*" style="margin-bottom:15px; width:100%;">
                
                <label style="color:#888; font-size:12px;">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</label>
                <textarea rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏ä‡πâ‡∏ñ‡πà‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤..."></textarea>
                
                <div class="modal-actions" style="display:flex; gap:10px; margin-top:15px;">
                    <button type="button" onclick="closeModal()" class="btn-cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn-confirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                </div>
            </form>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <div class="modal-content" style="width: 700px;">
            <span class="close" onclick="closeHistoryModal()">&times;</span>
            <h3 style="color:var(--theme-primary); margin-top:0;"><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
            
            <div class="table-responsive">
                <table class="data-table" style="width:100%; color:white; font-size:14px;">
                    <thead>
                        <tr>
                            <th style="border-bottom:1px solid var(--theme-primary);">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                            <th style="border-bottom:1px solid var(--theme-primary);">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th style="border-bottom:1px solid var(--theme-primary);">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th style="border-bottom:1px solid var(--theme-primary);">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody"></tbody>
                </table>
            </div>
            
            <div style="margin-top:20px; text-align:right;">
                <button onclick="closeHistoryModal()" class="btn-cancel">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
            </div>
        </div>
    </div>

    <audio id="bgMusic"></audio> 
    <div id="musicControl" onclick="toggleMusic()" style="
        position: fixed; bottom: 20px; left: 20px; z-index: 9999;
        background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.2); color: white; 
        padding: 10px 15px; border-radius: 30px; cursor: pointer; 
        font-family: 'Poppins', sans-serif; font-size: 14px;
        display: flex; align-items: center; gap: 8px;
        transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    ">
        <div id="musicIcon">üîá</div>
        <span id="musicText">Click to Play</span>
    </div>

    <script>
        // --- üéµ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á (Playlist) ---
        const playlist = [
            "https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3", 
            "https://cdn.pixabay.com/download/audio/2022/03/10/audio_c8c8a73467.mp3?filename=spirit-blossom-15285.mp3",
            "https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3?filename=lofi-chill-medium-version-159456.mp3"
        ];

        let currentTrack = 0;
        const music = document.getElementById('bgMusic');
        const btn = document.getElementById('musicControl');
        const icon = document.getElementById('musicIcon');
        const text = document.getElementById('musicText');
        music.volume = 0.3; 

        function loadTrack(index) {
            music.src = playlist[index];
            music.load();
        }

        function nextTrack() {
            currentTrack++;
            if (currentTrack >= playlist.length) currentTrack = 0; 
            loadTrack(currentTrack);
            music.play();
            updateButtonState(true);
        }

        music.addEventListener('ended', nextTrack);

        function updateButtonState(isPlaying) {
            if (isPlaying) {
                btn.style.background = "var(--theme-primary)";
                btn.style.color = "black";
                icon.innerText = "üéµ";
                icon.style.animation = "spin 2s linear infinite";
                text.innerText = `Track ${currentTrack + 1}`;
            } else {
                btn.style.background = "rgba(0, 0, 0, 0.6)";
                btn.style.color = "white";
                icon.innerText = "üîá";
                icon.style.animation = "none";
                text.innerText = "Music Paused";
            }
        }

        function toggleMusic() {
            if (music.paused) { music.play(); updateButtonState(true); } 
            else { music.pause(); updateButtonState(false); }
        }

        loadTrack(currentTrack);

        window.addEventListener('load', () => {
            const playPromise = music.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => { updateButtonState(true); })
                .catch(error => {
                    console.log("Autoplay blocked.");
                    document.body.addEventListener('click', () => { music.play(); updateButtonState(true); }, { once: true });
                });
            }
        });

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } #musicControl:hover { transform: scale(1.05); }`;
        document.head.appendChild(styleSheet);
    </script>

    <script type="module" src="script.js"></script>
</body>
</html>